% TODO
% subjects to write 
% axis angle theory, to projection
% how I calc the wall normal


\section{Skyline detection}
 \subsection{Introduction}
If we take a regular image on which both sky and earth are present, there
is often a clear separation between them. This separation is called the
skyline. %oehhhhhhh 
The detection of this skyline has proven to be a very successful computer vision
application in a wide range of domains. In this project it is used at urban
images to provide a contour of a building.  The contour will be used to
provide 3D information about the scene. This is a brand new purpose of skyline
detection.\\
For our application the skyline detector must be accurate, robust and must
operate without any user interaction. This makes it different from existing
skyline techniques.\\
The organization of this chapter is as follows:  First we give a summary of
related work on skyline detection.  Next we explain how we developed a new
robust skyline detection algorithm.  Then we present and discuss some results
and, finally, we conclude.

\subsubsection{Related work}
Castano et al. \cite{Dust} present a clear introduction of different skyline
detection techniques. We used this paper as an inspiration to write this related work
section.

%structure
% field of application (aim)
% method
% pro's cons

% TODO images in related work
\paragraph{Detection of dust devils and clouds on Mars}
In \cite{Dust}, mars Exploration Rovers are used to detect clouds and dust devils on Mars.
Their approach is to first identify the sky and then determine if there are
clouds in the region segmented as sky. The sky is detected by an innovative
algorithm that consists of three steps.  First they place seeds in a sliding
window whenever the homogeneity of the window is high. Then they grow this seeds
in the direction of edges which are estimated using a Sobel edge detector.
Finally each pixel located above the grew seeds is classified as sky.\\

This method looks like the most sophisticated one, as it is accurate and
autonomous. However, we have a stable scene with sharp edges at the
building contour so this method would be an implementation overkill.  


\paragraph{Horizon detection for Unmanned Air Vehicles}
In this domain, scientists detect the horizon to stabilize and control the
flight of Unmanned Air Vehicles.\\  
S.M. Ettinger et all \cite{Guidedflight} use a horizon detector that takes advantage of the high altitude of the vehicle, the
horizon is approximated to be a straight line.  An algorithm is present which is
based on the idea that this straight line separates the image into two regions
that have a different appearance. They use color as a measure of appearance and
generate two color distributions: one for the sky and one for the ground. The
distributions are optimized using bisection search on a criterion that uses the
covariance and the eigen values of the distributions. The line that best
separates the two distributions is determined to be the horizon.\\

This work is not applicable for detecting a building contour as the
straight line assumption doesn't work. But it needs to be mentioned that some
inspiration for chapter %TODO check Ref
comes from this idea because the building has walls that have straight lines.

\paragraph{Planetary Rover localization}
%TODO
Cozman et al. \cite{Rover} use skyline detection in planetary rovers to estimate their location.  Their
previous method to detect the skyline was based on feature matching. The current
method is signal-based and puts the focus correspondences among dense structures
in the image.\\
A given map of the landscape (hills, roads, etc) is aligned with the
signal-based skyline to recover the rover's position.\\

The advantage of their technique is the simplicity and effectiveness of the
algorithm which could make it suitable for this project.  A big drawback is that
it is strongly geared toward speed over high accuracy. To increase accuracy the
detector is part of an interactive system where an operator refines the skyline.
For our application the skyline detector must operate without any user
interaction. Furthermore it has to be robust and accurate enough to fit to the next module
in the system.  Nevertheless the work of Cozman et al. \cite{Rover} seemed to fit most on
this project as it uses a simple but effective algorithm.  We decided to use
this method as a basis and to build a custom algorithm with higher accuracy on
top of that. This is explained in the next section.


\subsection{Method} % the algorithm, maar Isaac vindt dit fijner
\subsubsection{Situation and assumptions}
Before we present the method let's define the situation and make some
assumptions.\\

\textbf{\emph{Definition: skyline in urban scene}}\\
\emph{A skyline in an urban scene is a set of points of the length $w$ (where $w$ is the
width of the size of the image) where each point describes the location of the
transition from the sky to an object (e.g. a building) which is mounted on the
earth.}

%motivate assumption
The first question arises: how are we going to detect the sky-building
transition point?\\ In general, the color of the sky is very different then the building color. A
color-based edge detector would be an intuitive decision.\\
However, the sky and building itself also contains edges (e.g. clouds and 
windows), so how do we determine the right edge?
The number of possible edges could be decreased by thresholding the intensity of
the edge but it would still be a difficult task to determine the right edge.\\


%TODO Read below and see if its still true
To solve this problem we draw an assumption that is inspired on inspired on the
idea of \cite{Rover}. Instead of using the sharpest edge we take the most upper sharp
edge and classify this edge as the skyline.

\textbf{\emph{Top sharp edge assumption}}
\emph{The first sharp edge (seen from top to bottom) in the image 
represents the skyline.}
%TODO read original paper and see if i can get some assumption
%TODO discussion:
%drawback assumption, plane flys by


%TODO
%aim
%discuss input and output algorithm 


\subsubsection{Related algorithm}
To put our work in context, we first describe a related skyline detection algorithm as presented in \cite{Rover}.\\
%TODO talk about assumptions

% nog meer woordjes vooraf?
%gaussian smooth (explain if reader is thumb)
To increase the difference between sharp and vague edges, and to let sharp edges
stand out more and vague edges disappear, the images are converted to Gaussian
smoothed images.  The smoothed image, which is a collection of $w$ x $h$ pixels,
is first divided in \#$w$ columns.  Next, each column produces a new column that
stores its vertical derivatives. This is called the smoothed intensity gradient.
The values of this column are high when a big change in color happens (e.g. an
edge is detected) at that location on the image. 
The system walks through the values of a column, starting from the top.  When it
detects a pixel with a gradient higher then a certain threshold it stores its
y-value (the location of the highest sharp edge of that column) and continues
to the next column.  The result is a set of $y$ coordinates of length $w$, that
represent the skyline. 

\subsubsection{Improved algorithm}
%TODO talk about the robustness
%TODO introduce a scene with bad lightning conditions
%motivation
Taking the smoothed intensity gradient is the most basic method of edge
detection and has the disadvantage that it is not robust to more vague edges. It
is not surprising that the algorithm in []%ref 
was used in an interactive system
where the user refines the result. 
Our aim is to develop a autonomous skyline detector, the only user interaction
that we allow is to provide the system some parameters. We will now discuss
the adaptations that we developed with respect to the related algorithm.\\

The column based approach of the related algorithm seems to be very useful and is
therefor unchanged.  The related algorithm uses the smoothed intensity gradient
as a method to detect edges. 
Because of the accuracy disadvantage of this method we took another approach in
detecting edges. Because we used Matlab as our implementation platform, we were
able to test different edge detecting types. The following edge detecting types
were tested.

%TODO
%Because the column based part of the algorithm is individual, it can read any
%image, we could totally develop a new preprocess step.

The output of the different edge detection techniques was studied on an empirical
basis and the Canny edge detector came with the most promising results. This is
probably because Canny is the most 'intelligent' edge detector.  It uses two
thresholds, one to detect strong and one to detect weak edges. It includes the weak edges in the
output, but only if they are connected to strong edges. In table %ref
we list Matlab's build in edge detectors together with the method explanation.

%TODO check in matlab if canny uses 2 thresholds as args 

%TODO tex table line breaks fixen
\begin{tabular}{|l|l|}
	\hline
	Edge detecting type		& method\\
	Sobel					& The Sobel method finds edges using the Sobel
	approximation to the derivative. It returns edges at those points where the
	gradient of I is maximum.\\
	\hline
	Prewitt					& The Prewitt method finds edges using the Prewitt
	approximation to the derivative. It returns edges at those points where the
	gradient of I is maximum.\\
	\hline
	Roberts					& The Roberts method finds edges using the Roberts
	approximation to the derivative. It returns edges at those points where the
	gradient of I is maximum.\\
	\hline
	Laplacian				& The Laplacian of Gaussian method finds edges by
	looking for zero crossings after filtering I with a Laplacian of Gaussian
	filter.\\
	\hline
	zero-cross				& The zero-cross method finds edges by looking for zero
	crossings after filtering I with a filter you specify.\\
	\hline
	Canny					& The Canny method finds edges by looking for local
	maxima of the gradient of I. The gradient is calculated using the derivative of
	a Gaussian filter. The method uses two thresholds, to detect strong and weak
	edges, and includes the weak edges in the output only if they are connected to
	strong edges. This method is therefor less likely than the others to be fooled
	by noise, and more likely to detect true weak edges.\\
	\hline
\end{tabular}

%TODO ML 
% check edge detector at different dataset and compair results
%However on an another scene an other edge type could perform better. 
Because the optimal edge detector type can be scene depended, it can be set
by the user as a parameter in our functions.\\

%TODO ML check in matlab if every edge detector returns a binary image
The Canny edge detector outputs a binary image, therefor the column inlier
threshold is set to 1, which means that it finds the first pixel that is white. 
This is, as in the related algorithm, done from top to bottom for every column in
the image.\\

Because we know we are looking for sharp edges we improved the algorithm by
introducing two preprocessing steps. First the contrast of the image is
increased, this makes sharp edges stand out more.  Secondly the image undertakes
an extra Gaussian blur, this removes a large part of the noise. Note that
depending on the edge detector type this could mean that the image is blurred
twice.\\

%TODO ML make different edge images, with and without each step (contrast, blur
% etc)

The system now has several parameters which have to be set manually by the user:
\begin{itemize}
	\item Contrast,
	% officially i don't do this contrast thing ghehe, whoepsie daisy fooling the
	% reader
	\item Intensity (window size) of Gaussian blur,
	\item Edge detector threshold.
\end{itemize}

%TODO write down what parameter I used, and worked best
If the user introduces a new dataset these parameters need to be configured
as the image quality and lightning condition are scene depended.


\subsection{Results}% (What did I find)
%TODO
% canny edge images
% skyline detector shizzle
Some results on the Floriande dataset %TODO ref
 can be seen in Figure \ref{fig:outputskyline}.
 %TODO introduce floriande dataset with intro text

\figs{outputskyline}{outputSkylineIm3-2.eps}{outputSkylineIm3-3.eps}{The output
of the edge detector}{The output of the skyline detector. The skyline elements are marked red}{1}
%TODO commands.tex fixen want de caption van b staat bij a


\subsection{Discussion}  % (What do my results mean to me and why)
The largest part of the building edge is detected, this is a nice result given
the algorithm operates without any user interaction.\\
The system assumes that the first sharp edge (seen from top to bottom) is always
the building contour. As can be seen in Figure ??, this gives raise to some
outliers, for example a streetlight or a tree. 
Other objects in the air that apear above the building but contain a sharp edge,
for example a plane, will also turn into outliers.  This is a drawback of the
	columnt based method.
The advantage of the method is its simplicity, automomity and low complexity.
We didn't focus on the development of a more accurate skyline detector because
this result is good enough for our purpose. We removed the outliers in a
different module of the system, this is described in the next section.  

%TODO discuss lamp and tree outlier

\subsection{Conclusion and Future work}
%TODO
A detailed research on related work research was done.
We introduced a brand new purpose of skyline detection: the extraction of a
building countour. We build an algorithm on top of a succesful existing
algorithm.  The algorithm doesn't depend on human intervention and is robust enough to give
(together with the module explained in the next section) accurate results.\\
It is interesting to denote that the skyline detector a stand alone method and
can be optimized individually without any knowledge of the other parts of the
project.
%TODO Test algo with and without the customisation

\paragraph{Future Work}
Although the outlier removal procedure is done in a seperate module it would be
nice to develop a skyline detector which is more robust to outliers.
In most of the related work there is focussed on detecting parts that are
classified as sky and parts that are classified as ground. In future work the
idea of a ground could be replaced by modeling a building. The distinctive
textures of the buildings (repeating bricks) could be used to classify a
pixel. Then a rough building contour could be estimated by using the
highest building pixel for every column. Detailed edge detection can be
done in this neighborhoud. In this way the outliers at the lamp and the tree are
filtered at this stage.


% TODO
% pictures
% explain motivation behind decisions
% explain what is new or what is unique


% TODO
% put this in one of the first chapters :
% an intro which answers the question:
% detail of the problem, why is this such a interesting problem
% what did others and how is my work related?
% write something about mogelijke complications en/of juist wat je er wel aan hebt
%

% TODO background section?
% image captions
% read whole report

% TODO: documentclass anders zodat alles breder is en plaatjes ook breder kunnen
% en niet bij 7cm al afbreken




