% thinks to bear in mind
% reader must be able to reproduce it

\section{Augmenting the 3D building estimate}
\subsection{Introduction}
From the previous section we saw how the skyline was detected and how every point on this skyline was projected on its most likely wall. (what does this mean in general)
We would like to use this information to augment the basic 3d model.

So we have as input a
- set of calibrated 2D images with a binary skyline indication
- a rough 3d model
The output is an updated 3d model.

For this an algoritm is designed which consist of several steps. 
First of all the individual skyline pixels are grouped into line segments using an approach of (TODO DAVID??OFZO) Hough.
Every line segment in 3D belongs to a specific wall which is heuristicly determined in the second step.
The third step is to combine the projected houghlinesegments which produces and estimate of the height of each wall.
In the last step this height is used to augment the rough 3d model.

%For simplicity reasons we assume that a building consists of a flat roof, note that the walls may have different heights but the roof should be flat.
%TODO cons pros of this assumption
%TODO vet goed dat ik dus mijn algo different wallheights aan kan, promoten!

%why fit lines on 2d and not in 3d
%cheaper easyer?
%we take a step back into the process (skyline detection)

 
\subsection{The algorithm}
\subsubsection{Extracting line segments} % Houghlines
	chainging / motivation:
	% details in appendix

	%houghlines on edge detection
	% write this chapter as last because
	% use wikipedia and my previous research for it 

	%this method can be seen as some sort of outlier removal?
	% write someting about the happy little DAMNED trees that we need to remove hehehe


\subsubsection{Heuristic Line-Wall determination}
<<<<<<< HEAD
	% what do we have what is the input
	Now we have 2D line segments which represent parts of the building contours. To be more precise a line segment presents a significant part of the upper side of a wall of the building.
	To determine which wall the linesegment belongs to it would be straightforward to use bouth linesegments endpoints and project it onto the building as in section %todo.
=======
	Now we have line segments which represent parts of the building contours. To be more precise a line segment presents a significant part of the upper side of a wall of the building.
	To determine which wall the linesegment presents it would be straightforward to use bouth linesegments endpoints and project it onto the building as in section %todo.
>>>>>>> f78f059aa1c1e255e733e49e2b655ada7073eac5
	%As can be seen in the previous section determining on which part of the building a skyline pixel belongs quite succesfull.
	But this introduces a little problem: some of the line segments have endpoints of the corner of the building.
	The linesegments endpoint on this corner could easily be classified as the ascending wall.
	The wall is now undetermined because both endpoints do not agree on the same wall.  
	To solve this problem some heuristic methods are developed and tested.
	% todo explain?
	%A heuristic is succesfull if it is simple and effective.
	The middle point of the line segment has a low change of being on a buildingcorner and a big change of being on the wall we are looking for.
<<<<<<< HEAD
	Therefor we use the middlepoint instead of the endpoints to determine the right wall.
	As in the previous section %TODO
	this middlepoint is intersected with all plaines spanned by the walls. The linesegment is stored to the wall with the shortest distance.
	%The output of this part of the algorithm is for every wall a bunch of associated linesegments originated from different views.
	\\
	Now all line segments are associated with a certain wall we can use this information to augment the 3D model.
	Before we do this we assume that every wall has a straight upperside. % TODO is dit niet al een kkeertje aangenomen jongu?
	% TODO hoezo?
	The last step for augmenting the buildinging, bearing this assumption in mind, is now boiled down to making a good estimate of the height of the wall of the building.
=======
	Therefor instead of the endpoints we use the middlepoint to determine the right wall.
	When the wall is known both endpoints are intersected to the plane that is spanned by the wall we just determined.
	%This gives the following result?
>>>>>>> f78f059aa1c1e255e733e49e2b655ada7073eac5

	%The middle point is used as a third candidate for voting oh yeah i love to vote men i love
	% I LOVE NIG GERNS I LOVE NIG RS
	
	% chaining
	%example image


	%decide which line segment represents which wall (heuristic)
\subsubsection{Wall height estimation}
	%calc average height of lines for each wall
	% update belonging wall
<<<<<<< HEAD
	In the previous section we saw that the line segments endpoints may be classified as differing walls. 
	Therefor we reproject the line segment endpoints to the calculated wall.

	The reprojection is done by intersecting both endpoints of the linesegment to the plane that is spanned by the wall that was found in the 
previous section.
	This is done for every linesegment. 
	All 3D intersection points are collected and averaged, this gives us an average of all midpoints of the projected lines.
	This value is used as the new height of the wall of the building.
	And this is done for every wall.
	
	%The coordinates of the projected endpoints are stored with the corresponding wall.
	%This gives the following result?

\subsubsection{Augmenting the 3D model} %todo other word then augment?
	% check in code how this is done?
	A wall exist of four corner points. The upper cornerpoints are adjusted
	by coping the bottomleft and right cornerpoints and adding the estimated height from the previous section to the y-value.
	Note that this method assumes that the walls are alligned on the y-axis. Which is in our dataset the case.

	%TODO iets zeggen over het ground plain, zie ook costins werk
=======

\subsubsection{Augmenting the 3D model} %todo other word then augment?



endpoints of houghlines belong to certain wall




>>>>>>> f78f059aa1c1e255e733e49e2b655ada7073eac5


\subsection{Results (What did I find)}
\subsection{Discussion (What do my results mean to me and why)}
\subsection{Conclusion and Future work}
The flat roof assumption could be stretched to a roof consist of two planes
<<<<<<< HEAD
\\
The middle point of the line is projected to all walls, it could be a significant speedup to reduce the set of walls to the walls found at the endpoints. This is not done because both endpoints could lie on a cornerpoint making none of the endpoints refering to the correct wall.
=======
>>>>>>> f78f059aa1c1e255e733e49e2b655ada7073eac5


%idea to think of (to detailed or not):
program and test different heuristics?
do analytic test (compare 1 and 3 analyticly)
	to much detail for something like this? or not?

Plan:
first write thesis without the heuristic part

IDEAS:
heuristic 1:
take a point in the middle and let it decide

heuristic 2:
the endpoint that lies more in the middle decides which wall we take
this can be calculated using the difference of distances to the wall corner points

heuristic 3:
take points on a houghline
make a rating that the more in a middle a point is the more evidence there is
this is because it is more away from a corner so lower change of other wall


% TODO
what to do with outliers
where to put the intersection algorithm part
for now i let it in skyline detection and refer to it
maybe later move it!
%TODO what are the mathematics
%TODO write something about complications and wat je er aan hebt
%what are the assumptions and heuristics
%use power of illustration, lots of example images! ask myself is there stil something left where I can add an illustration??



